
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Writeup for challenge "sssshhhh" of Down Under CTF 2024">
      
      
      
      
        <link rel="prev" href="../sign_in/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>sssshhhh writeup - DU CTF 2024</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prologue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DU CTF 2024" class="md-header__button md-logo" aria-label="DU CTF 2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DU CTF 2024
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              sssshhhh writeup
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/sukolenvo/2024duCTF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DU CTF 2024" class="md-nav__button md-logo" aria-label="DU CTF 2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DU CTF 2024
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sukolenvo/2024duCTF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DownUnderCTF 2024 Writeups
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../shufflebox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shufflebox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../number_mashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Number mashing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../transmissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intercepted transmissions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector overflow
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../decrypt_eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decrypt then eval
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../yawa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yawa
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dna/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNAdecay
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sign_in/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sign in
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    sssshhhh
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    sssshhhh
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prologue" class="md-nav__link">
    <span class="md-ellipsis">
      Prologue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-struggle" class="md-nav__link">
    <span class="md-ellipsis">
      My struggle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epilogue" class="md-nav__link">
    <span class="md-ellipsis">
      Epilogue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prologue" class="md-nav__link">
    <span class="md-ellipsis">
      Prologue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-struggle" class="md-nav__link">
    <span class="md-ellipsis">
      My struggle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epilogue" class="md-nav__link">
    <span class="md-ellipsis">
      Epilogue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/sukolenvo/2024duCTF/edit/master/docs/sssshhhh/index.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>sssshhhh</h1>

<h2 id="prologue">Prologue<a class="headerlink" href="#prologue" title="Permanent link">&para;</a></h2>
<p>Difficulty: beginner</p>
<p>Category: reverse engineering</p>
<p>Solved: 81</p>
<div class="admonition quote">
<p class="admonition-title">Description</p>
<p>Great news! We found the Kookaburras!... Bad news.. They're locked up. We've managed to get access to the central terminal and ripped a binary off of it for you to analyse. Maybe you can find a way to free our friends?</p>
</div>
<p>Input files:</p>
<ul>
<li><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/blob/f2797a33d8f5851508f37e854afceedf85eee8a3/beginner/sssshhhh/src/cmd/cmd">server binary</a></li>
</ul>
<p>NB:</p>
<ul>
<li>
<p>Following indices bases system is used to avoid ambiguity. Whenever element of a collection is referenced by <strong>number</strong>, 0-based index implied. </p>
<p>Ie, element <code>0</code> of list <code>[1, 2, 4, 8, 16]</code> is <code>1</code>, Element <code>3</code> is <code>8</code>.</p>
<p>When element is reference in explanation with <strong>word</strong> (first, third...), 1-based system is implied.</p>
<p>Ie, first character of string <code>Hello World!</code> is <code>H</code>, fifth is <code>o</code>.</p>
</li>
</ul>
<ul>
<li>Solution code was redacted for readability purposes. Due to time pressure during the competition I was using a lot of one-letter variables and questionable code structure.</li>
</ul>
<ul>
<li>I am using gdb with <a href="https://github.com/pwndbg/pwndbg">pwndbg</a> plugin</li>
</ul>
<h2 id="my-struggle">My struggle<a class="headerlink" href="#my-struggle" title="Permanent link">&para;</a></h2>
<p>What do we do the first when we have an unknown binary? Lets run it:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>./server
<span class="m">5</span>:29PM<span class="w"> </span>INFO<span class="w"> </span>Starting<span class="w"> </span>SSH<span class="w"> </span>Server<span class="w"> </span><span class="nv">host</span><span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="nv">port</span><span class="o">=</span><span class="m">1337</span>
</code></pre></div></td></tr></table></div>
<p>When we try to ssh to it we see that it requires a password. So lets open in <a href="https://ghidra-sre.org/">Ghidra</a> and see if we can find it.</p>
<p><code>main</code> function has calls <code>startLogger()</code> and <code>RunSSH()</code>. Second call is interesting - it should initialise user accounts somehow. In code there are a lot of
references to <a href="https://github.com/charmbracelet/ssh">https://github.com/charmbracelet/ssh</a> which is a go package for embeded ssh server. In the documentation and examples of the 
library we can see how usually password authentication is configured <a href="https://pkg.go.dev/github.com/gliderlabs/ssh#PasswordAuth">https://pkg.go.dev/github.com/gliderlabs/ssh#PasswordAuth</a>, so we know what 
to look for. </p>
<p>Two interesting lines in <code>RunSSH()</code> that caught my eye:</p>
<p><div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">local_b0</span><span class="p">.</span><span class="n">_8_8_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PTR_main</span><span class="p">.</span><span class="n">RunSSH</span><span class="p">.</span><span class="n">func2_0069c798</span><span class="p">;</span>
<span class="n">local_b0</span><span class="p">.</span><span class="n">_0_8_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">RunSSH</span><span class="p">.</span><span class="n">WithPasswordAuth</span><span class="p">.</span><span class="n">PasswordAuth</span><span class="p">.</span><span class="n">func10</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
From docs we know that PasswordAuth take a parameter - PasswordHandler. Address of the <code>func2</code> is taken right before PasswordAuth setup. Its worth
to check the code of the func2:
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">undefined8</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">RunSSH</span><span class="p">.</span><span class="n">func2</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">param_1</span><span class="p">,</span><span class="n">undefined8</span><span class="w"> </span><span class="n">param_2</span><span class="p">,</span><span class="n">undefined8</span><span class="w"> </span><span class="n">param_3</span><span class="p">,</span><span class="n">undefined8</span><span class="w"> </span><span class="n">param_4</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">undefined8</span><span class="w"> </span><span class="n">uVar1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">unaff_R14</span><span class="p">;</span>
<span class="w">  </span><span class="n">undefined8</span><span class="w"> </span><span class="n">param_9</span><span class="p">;</span>

<span class="w">  </span><span class="n">param_9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param_4</span><span class="p">;</span>
<span class="hll"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">param_1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x23</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="n">uVar1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">memequal</span><span class="p">();</span>
</span><span class="hll"><span class="w">  </span><span class="p">}</span>
</span><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uVar1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">uVar1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
It compares some number (length?) to 0x23 and then calls <code>memequal</code>. Strangely, <code>memequel</code> doesn't take any params. Eventually I checked disassembly for this line:
<div class="language-asm highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">MOV</span><span class="w">        </span><span class="no">RAX</span><span class="p">,</span><span class="no">param_4</span>
<span class="nf">LEA</span><span class="w">        </span><span class="no">RBX</span><span class="p">,[</span><span class="no">DAT_0067ec99</span><span class="p">]</span><span class="w"> </span>
<span class="no">MOV</span><span class="w">        </span><span class="no">RCX</span><span class="p">,</span><span class="mi">0x23</span><span class="w">  </span>
<span class="no">CALL</span><span class="w">       </span><span class="no">runtime.memequal</span>
</code></pre></div></td></tr></table></div>
First it moves param_4 to RAX (password?), then loads value from DAT_0067ec99 to RBX, 0x23 is likely length and calls memequal.</p>
<p>We can see password in plain text at address DAT_0067ec99, now lets try to connect:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code>└─$<span class="w"> </span>ssh<span class="w"> </span>localhost<span class="w"> </span>-p<span class="w"> </span><span class="m">1337</span><span class="w">                        </span>
<span class="w"> </span>____<span class="w">  </span>__.<span class="w">             </span>__<span class="w">          </span>___.<span class="w">                               </span>
<span class="p">|</span><span class="w">    </span><span class="p">|</span>/<span class="w"> </span>_<span class="p">|</span>____<span class="w">   </span>____<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>_______<span class="w"> </span><span class="se">\_</span><span class="w"> </span><span class="p">|</span>__<span class="w">  </span>__<span class="w"> </span>_____________________<span class="w">   </span>
<span class="p">|</span><span class="w">      </span>&lt;<span class="w"> </span>/<span class="w">  </span>_<span class="w"> </span><span class="se">\ </span>/<span class="w">  </span>_<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span>/<span class="w"> </span>/<span class="se">\_</span>_<span class="w">  </span><span class="se">\ </span><span class="p">|</span><span class="w"> </span>__<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="se">\_</span><span class="w">  </span>__<span class="w"> </span><span class="se">\_</span><span class="w">  </span>__<span class="w"> </span><span class="se">\_</span>_<span class="w">  </span><span class="se">\ </span><span class="w"> </span>
<span class="p">|</span><span class="w">    </span><span class="p">|</span><span class="w">  </span><span class="o">(</span><span class="w">  </span>&lt;_&gt;<span class="w"> </span><span class="p">|</span><span class="w">  </span>&lt;_&gt;<span class="w"> </span><span class="o">)</span><span class="w">    </span>&lt;<span class="w">  </span>/<span class="w"> </span>__<span class="w"> </span><span class="se">\|</span><span class="w"> </span><span class="se">\_\ \ </span><span class="w"> </span><span class="p">|</span><span class="w">  </span>/<span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="se">\/</span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="se">\/</span>/<span class="w"> </span>__<span class="w"> </span><span class="se">\_</span>
<span class="p">|</span>____<span class="p">|</span>__<span class="w"> </span><span class="se">\_</span>___/<span class="w"> </span><span class="se">\_</span>___/<span class="p">|</span>__<span class="p">|</span>_<span class="w"> </span><span class="se">\(</span>____<span class="w">  </span>/___<span class="w">  </span>/____/<span class="w"> </span><span class="p">|</span>__<span class="p">|</span><span class="w">   </span><span class="p">|</span>__<span class="p">|</span><span class="w">  </span><span class="o">(</span>____<span class="w">  </span>/
<span class="w">        </span><span class="se">\/</span><span class="w">                 </span><span class="se">\/</span><span class="w">     </span><span class="se">\/</span><span class="w">    </span><span class="se">\/</span><span class="w">                         </span><span class="se">\/</span><span class="w"> </span>
<span class="w">  </span>___<span class="w"> </span>___<span class="w">        </span>.__<span class="w">       </span>.___.__<span class="w">                                    </span>
<span class="w"> </span>/<span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="se">\ </span><span class="w"> </span>____<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">    </span>__<span class="p">|</span><span class="w"> </span>_/<span class="p">|</span>__<span class="p">|</span><span class="w"> </span>____<span class="w">    </span>____<span class="w">                      </span>
/<span class="w">    </span>~<span class="w">    </span><span class="se">\/</span><span class="w">  </span>_<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span><span class="w">   </span>/<span class="w"> </span>__<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span>/<span class="w">    </span><span class="se">\ </span><span class="w"> </span>/<span class="w"> </span>___<span class="se">\ </span><span class="w">                    </span>
<span class="se">\ </span><span class="w">   </span>Y<span class="w">    </span><span class="o">(</span><span class="w">  </span>&lt;_&gt;<span class="w"> </span><span class="o">)</span><span class="w">  </span><span class="p">|</span>__/<span class="w"> </span>/_/<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">  </span><span class="se">\/</span><span class="w"> </span>/_/<span class="w">  </span>&gt;<span class="w">                    </span>
<span class="w"> </span><span class="se">\_</span>__<span class="p">|</span>_<span class="w">  </span>/<span class="w"> </span><span class="se">\_</span>___/<span class="p">|</span>____/<span class="se">\_</span>___<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>__<span class="p">|</span>___<span class="p">|</span><span class="w">  </span>/<span class="se">\_</span>__<span class="w">  </span>/<span class="w">                     </span>
<span class="w">       </span><span class="se">\/</span><span class="w">                   </span><span class="se">\/</span><span class="w">         </span><span class="se">\/</span>/_____/<span class="w">                      </span>
_________<span class="w">        </span>.__<span class="w">  </span>.__<span class="w">                                             </span>
<span class="se">\_</span><span class="w">   </span>___<span class="w"> </span><span class="se">\ </span><span class="w"> </span>____<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">   </span>______<span class="w">                                   </span>
/<span class="w">    </span><span class="se">\ </span><span class="w"> </span><span class="se">\/</span>_/<span class="w"> </span>__<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>/<span class="w">  </span>___/<span class="w">                                   </span>
<span class="se">\ </span><span class="w">    </span><span class="se">\_</span>__<span class="se">\ </span><span class="w"> </span>___/<span class="p">|</span><span class="w">  </span><span class="p">|</span>_<span class="p">|</span><span class="w">  </span><span class="p">|</span>__<span class="se">\_</span>__<span class="w"> </span><span class="se">\ </span><span class="w">                                   </span>
<span class="w"> </span><span class="se">\_</span>_____<span class="w">  </span>/<span class="se">\_</span>__<span class="w">  </span>&gt;____/____/____<span class="w">  </span>&gt;<span class="w">                                   </span>
<span class="w">        </span><span class="se">\/</span><span class="w">     </span><span class="se">\/</span><span class="w">               </span><span class="se">\/</span><span class="w">                                    </span>
kali@localhost<span class="err">&#39;</span>s<span class="w"> </span>password:<span class="w"> </span>
Welcome,<span class="w"> </span>kali!
This<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>Kookaburra<span class="w"> </span>holding<span class="w"> </span>cells.
<span class="w">        </span>Contained:<span class="w"> </span><span class="m">11912</span><span class="w"> </span>Kookaburras
<span class="w">        </span>-&gt;<span class="w"> </span>No<span class="w"> </span>valid<span class="w"> </span><span class="nb">command</span>
elapsed<span class="w"> </span>time:<span class="w"> </span><span class="m">552</span>.727µs
Connection<span class="w"> </span>to<span class="w"> </span>localhost<span class="w"> </span>closed.
</code></pre></div></td></tr></table></div></p>
<p>We can see line <code>-&gt; No valid command</code>. This looks like a hint of the next obstacle. Our work with Ghidra is not finished yet. There should be handler somewhere with
commands list. We are looking for something that calculates elapsed time or prints kookaburras count. Eventually I restarted
server with gdb and set a breakpoint to printf function found through stack trace that handler for the server is func_8_1.</p>
<p>There we can see following check:
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">((((</span><span class="n">pplVar6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">DAT_0000000e</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">plVar2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pplVar6</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">plVar2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x68546b636f6c6e55</span><span class="p">))</span>
</span><span class="hll"><span class="w">      </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">plVar2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x6c654365</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="p">)((</span><span class="kt">long</span><span class="p">)</span><span class="n">plVar2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0xc</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x736c</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">    </span><span class="n">os</span><span class="p">.</span><span class="n">Getenv</span><span class="p">();</span>
<span class="w">    </span><span class="n">local_28</span><span class="p">.</span><span class="n">_8_8_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PTR_DAT_006df670</span><span class="p">;</span>
<span class="w">    </span><span class="n">local_28</span><span class="p">.</span><span class="n">_0_8_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">DAT_00625400</span><span class="p">;</span>
<span class="w">    </span><span class="n">auVar9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">convTstring</span><span class="p">();</span>
<span class="w">    </span><span class="n">local_18</span><span class="p">.</span><span class="n">_8_8_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auVar9</span><span class="p">.</span><span class="n">_0_8_</span><span class="p">;</span>
<span class="w">    </span><span class="n">local_18</span><span class="p">.</span><span class="n">_0_8_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">DAT_00625400</span><span class="p">;</span>
<span class="w">    </span><span class="n">auVar9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fmt</span><span class="p">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">auVar9</span><span class="p">.</span><span class="n">_8_8_</span><span class="p">,</span><span class="n">local_28</span><span class="p">);</span>
<span class="w">    </span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">charmbracelet</span><span class="o">/</span><span class="n">wish</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">auVar9</span><span class="p">.</span><span class="n">_8_8_</span><span class="p">,</span><span class="n">auVar9</span><span class="p">.</span><span class="n">_0_8_</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
This is very common compiler optimisation for comparing short strings with static text. Converting constants <code>0x68546b636f6c6e55 0x6c654365 0x736c</code> to ascii 
and reversing order of each number (little endian) gives us the command. Lets try it:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>ssh<span class="w"> </span>localhost<span class="w"> </span>-p<span class="w"> </span><span class="m">1337</span><span class="w">  </span>UnlockTheCells<span class="w">  </span>
<span class="w"> </span>____<span class="w">  </span>__.<span class="w">             </span>__<span class="w">          </span>___.<span class="w">                               </span>
<span class="p">|</span><span class="w">    </span><span class="p">|</span>/<span class="w"> </span>_<span class="p">|</span>____<span class="w">   </span>____<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>_______<span class="w"> </span><span class="se">\_</span><span class="w"> </span><span class="p">|</span>__<span class="w">  </span>__<span class="w"> </span>_____________________<span class="w">   </span>
<span class="p">|</span><span class="w">      </span>&lt;<span class="w"> </span>/<span class="w">  </span>_<span class="w"> </span><span class="se">\ </span>/<span class="w">  </span>_<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span>/<span class="w"> </span>/<span class="se">\_</span>_<span class="w">  </span><span class="se">\ </span><span class="p">|</span><span class="w"> </span>__<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="se">\_</span><span class="w">  </span>__<span class="w"> </span><span class="se">\_</span><span class="w">  </span>__<span class="w"> </span><span class="se">\_</span>_<span class="w">  </span><span class="se">\ </span><span class="w"> </span>
<span class="p">|</span><span class="w">    </span><span class="p">|</span><span class="w">  </span><span class="o">(</span><span class="w">  </span>&lt;_&gt;<span class="w"> </span><span class="p">|</span><span class="w">  </span>&lt;_&gt;<span class="w"> </span><span class="o">)</span><span class="w">    </span>&lt;<span class="w">  </span>/<span class="w"> </span>__<span class="w"> </span><span class="se">\|</span><span class="w"> </span><span class="se">\_\ \ </span><span class="w"> </span><span class="p">|</span><span class="w">  </span>/<span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="se">\/</span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="se">\/</span>/<span class="w"> </span>__<span class="w"> </span><span class="se">\_</span>
<span class="p">|</span>____<span class="p">|</span>__<span class="w"> </span><span class="se">\_</span>___/<span class="w"> </span><span class="se">\_</span>___/<span class="p">|</span>__<span class="p">|</span>_<span class="w"> </span><span class="se">\(</span>____<span class="w">  </span>/___<span class="w">  </span>/____/<span class="w"> </span><span class="p">|</span>__<span class="p">|</span><span class="w">   </span><span class="p">|</span>__<span class="p">|</span><span class="w">  </span><span class="o">(</span>____<span class="w">  </span>/
<span class="w">        </span><span class="se">\/</span><span class="w">                 </span><span class="se">\/</span><span class="w">     </span><span class="se">\/</span><span class="w">    </span><span class="se">\/</span><span class="w">                         </span><span class="se">\/</span><span class="w"> </span>
<span class="w">  </span>___<span class="w"> </span>___<span class="w">        </span>.__<span class="w">       </span>.___.__<span class="w">                                    </span>
<span class="w"> </span>/<span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="se">\ </span><span class="w"> </span>____<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">    </span>__<span class="p">|</span><span class="w"> </span>_/<span class="p">|</span>__<span class="p">|</span><span class="w"> </span>____<span class="w">    </span>____<span class="w">                      </span>
/<span class="w">    </span>~<span class="w">    </span><span class="se">\/</span><span class="w">  </span>_<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span><span class="w">   </span>/<span class="w"> </span>__<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span>/<span class="w">    </span><span class="se">\ </span><span class="w"> </span>/<span class="w"> </span>___<span class="se">\ </span><span class="w">                    </span>
<span class="se">\ </span><span class="w">   </span>Y<span class="w">    </span><span class="o">(</span><span class="w">  </span>&lt;_&gt;<span class="w"> </span><span class="o">)</span><span class="w">  </span><span class="p">|</span>__/<span class="w"> </span>/_/<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">  </span><span class="se">\/</span><span class="w"> </span>/_/<span class="w">  </span>&gt;<span class="w">                    </span>
<span class="w"> </span><span class="se">\_</span>__<span class="p">|</span>_<span class="w">  </span>/<span class="w"> </span><span class="se">\_</span>___/<span class="p">|</span>____/<span class="se">\_</span>___<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>__<span class="p">|</span>___<span class="p">|</span><span class="w">  </span>/<span class="se">\_</span>__<span class="w">  </span>/<span class="w">                     </span>
<span class="w">       </span><span class="se">\/</span><span class="w">                   </span><span class="se">\/</span><span class="w">         </span><span class="se">\/</span>/_____/<span class="w">                      </span>
_________<span class="w">        </span>.__<span class="w">  </span>.__<span class="w">                                             </span>
<span class="se">\_</span><span class="w">   </span>___<span class="w"> </span><span class="se">\ </span><span class="w"> </span>____<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">   </span>______<span class="w">                                   </span>
/<span class="w">    </span><span class="se">\ </span><span class="w"> </span><span class="se">\/</span>_/<span class="w"> </span>__<span class="w"> </span><span class="se">\|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>/<span class="w">  </span>___/<span class="w">                                   </span>
<span class="se">\ </span><span class="w">    </span><span class="se">\_</span>__<span class="se">\ </span><span class="w"> </span>___/<span class="p">|</span><span class="w">  </span><span class="p">|</span>_<span class="p">|</span><span class="w">  </span><span class="p">|</span>__<span class="se">\_</span>__<span class="w"> </span><span class="se">\ </span><span class="w">                                   </span>
<span class="w"> </span><span class="se">\_</span>_____<span class="w">  </span>/<span class="se">\_</span>__<span class="w">  </span>&gt;____/____/____<span class="w">  </span>&gt;<span class="w">                                   </span>
<span class="w">        </span><span class="se">\/</span><span class="w">     </span><span class="se">\/</span><span class="w">               </span><span class="se">\/</span><span class="w">                                    </span>
kali@localhost<span class="err">&#39;</span>s<span class="w"> </span>password:<span class="w"> </span>
Welcome<span class="w"> </span>Warden,<span class="w"> </span>running<span class="w"> </span><span class="nb">command</span>
Welcome,<span class="w"> </span>kali!
This<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>Kookaburra<span class="w"> </span>holding<span class="w"> </span>cells.
<span class="w">        </span>Contained:<span class="w"> </span><span class="m">11912</span><span class="w"> </span>Kookaburras
<span class="w">        </span>-&gt;<span class="w"> </span>No<span class="w"> </span>valid<span class="w"> </span><span class="nb">command</span>
elapsed<span class="w"> </span>time:<span class="w"> </span><span class="m">666</span>.382µs
</code></pre></div></td></tr></table></div>
<p>And it did nothing - I still see <code>no valid command</code>. Well actually now there is one more line <code>Welcome Warden, running command</code>, but then it says command is still invalid.
In code inside the <code>if</code> block there is <code>os.GetEnv()</code>, so likely this is where flag comes from. Restarting server with following command:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">WARDEN</span><span class="o">=</span>myflag<span class="w"> </span>./server<span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>Connecting to server now gave the flag. </p>
<h2 id="epilogue">Epilogue<a class="headerlink" href="#epilogue" title="Permanent link">&para;</a></h2>
<ul>
<li>Official website: <a href="https://downunderctf.com/">https://downunderctf.com/</a></li>
<li>Official writeups: <a href="https://github.com/DownUnderCTF/Challenges_2024_Public">https://github.com/DownUnderCTF/Challenges_2024_Public</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../sign_in/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Sign in">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Sign in
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>